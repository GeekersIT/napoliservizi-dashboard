<mat-toolbar>
    <span>{{ 'Gestione toponimi'|translate }}</span>
    <span class="spacer"></span>
</mat-toolbar>
<div class="main-content">
    <table-component [source]="dataSource" [columns]="columns" [expandsTemplate]="expandsTemplate" [actionsTemplate]="actionsTemplate" [filterTemplate]="filterTemplate" [isLoading]="isLoading"></table-component>
</div>

<ng-template #filterTemplate>
    <form-component [options]="options" [model]="model" [fields]="fields" [actionsTemplate]="filterActionsTemplate" (resetEvent)="reset($event)"></form-component>
    <ng-template #filterActionsTemplate>
        <button mat-button (click)="applyFilter()">{{ 'Applica filtro'|translate }}</button>
    </ng-template>

    <ng-template let-option="option" #optionTemplate>
        {{ option.nome }}
    </ng-template>

</ng-template>

<ng-template let-row="row" #expandsTemplate>
    <div style="width: 30%;">
        <mat-list>
            <div mat-subheader>{{ 'Denominazione attuale'|translate }}</div>
            <mat-list-item >
              <div mat-line><span *ngIf="row.dug!=null">{{ row.dug.nome }}</span> {{ row.nome }}</div>
              <div mat-line> {{ 'Valida da {data}'|translate:{data:row.updated_at | date:'full':'it'} }} </div>
            </mat-list-item>
            <mat-divider></mat-divider>
            <div mat-subheader>{{ 'Vecchie denominazioni'|translate }}</div>
            <ng-container *ngIf="row.vecchie_denominazioni.length != 0; else empty">
                <mat-list-item  *ngFor="let denominazioni of row.vecchie_denominazioni;">
                    <div mat-line><span *ngIf="denominazioni.dug!=null">{{ denominazioni.dug.nome }}</span> {{ denominazioni.nome }}</div>
                    <div mat-line> {{ 'Valida fino a {data}'|translate:{data:denominazioni.created_at | date:'full':'it'} }} </div>
                </mat-list-item>
            </ng-container>
            <ng-template #empty>
                <mat-list-item>
                    <div mat-line style="font-size:14px">{{ 'Non ci sono vecchie denominazioni'|translate }}</div>
                </mat-list-item>
            </ng-template>
        </mat-list>
    </div>
    <div style="width: 70%">
        <mat-list>
            <div mat-subheader>{{ 'Quartiere attuale'|translate }}</div>
                <mat-list-item *ngFor="let quartiere of row.quartieri">
                  <div mat-line>{{ quartiere.quartiere.quartiere.nome }}<span *ngIf="quartiere.quartiere.quartiere.municipalita.length > 0"> - {{ quartiere.quartiere.quartiere.municipalita[0].municipalita.municipalita.nome }}</span></div>
                  <div mat-line>{{ 'Valida da {data}'|translate:{data:quartiere.quartiere.inizio_validita | date:'full':'it'} }}</div>
                </mat-list-item>
            <mat-divider></mat-divider>
            <div mat-subheader>{{ 'Vecchi quartieri'|translate }}</div>
            <ng-container *ngIf="row.vecchi_quartieri.length != 0; else empty1">
                <mat-list-item *ngFor="let quartiere of row.vecchi_quartieri">
                    <div mat-line>{{ quartiere.quartiere.quartiere.nome }}<span *ngIf="quartiere.quartiere.quartiere.municipalita.length > 0"> - {{ quartiere.quartiere.quartiere.municipalita[0].municipalita.municipalita.nome }}</span></div>
                    <div mat-line>{{ 'Valida fino a {data}'|translate:{data:quartiere.quartiere.fine_validita | date:'full':'it'} }}</div>
                  </mat-list-item>
            </ng-container>
            <ng-template #empty1>
                <mat-list-item>
                    <div mat-line style="font-size:14px">{{ 'Non ci sono vecchi quartieri'|translate }}</div>
                </mat-list-item>
            </ng-template>
        </mat-list>
    </div>
</ng-template>

<ng-template let-row="row" #actionsTemplate>
    <button mat-stroked-button color="accent" [routerLink]="['/','toponomastica','toponimi','edit',row.id]">
        <mat-icon>edit</mat-icon>
        {{ 'Modifica'|translate }}
    </button>
</ng-template>